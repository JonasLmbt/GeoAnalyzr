{
  "$schema": "./dashboard.schema.json",
  "schemaVersion": "0.1.0",
  "dashboard": {
    "id": "default",
    "title": "GeoAnalyzr",
    "globalFilters": {
      "enabled": true,
      "layout": { "variant": "compact" },
      "controls": [
        {
          "id": "dateRange",
          "type": "date_range",
          "label": "From / To",
          "default": { "fromTs": null, "toTs": null },
          "appliesTo": ["round", "game", "session"]
        },
        {
          "id": "movement",
          "type": "select",
          "label": "Movement",
          "dimension": "movement_type",
          "default": "all",
          "options": "auto_distinct",
          "appliesTo": ["round"]
        },
        {
          "id": "teammate",
          "type": "select",
          "label": "Teammate",
          "dimension": "teammate_name",
          "default": "all",
          "options": "auto_teammates",
          "appliesTo": ["round"]
        },
        {
          "id": "guessTimeBucket",
          "type": "select",
          "label": "Guess time",
          "dimension": "duration_bucket",
          "default": "all",
          "options": "auto_distinct",
          "appliesTo": ["round"]
        },
        {
          "id": "country",
          "type": "select",
          "label": "Country",
          "dimension": "true_country",
          "default": "all",
          "options": "auto_distinct",
          "appliesTo": ["round"]
        }
      ],
      "buttons": { "apply": false, "reset": true }
    },
    "sections": [
      {
        "id": "overview",
        "title": "Overview",
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_overview_main",
              "title": "Overview",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 22,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_overview_facts",
                    "type": "stat_list",
                    "title": "Results, Win Rate & Ratings",
                    "grain": "game",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 7 },
                    "spec": {
                      "rows": [
                        {
                          "label": "Games",
                          "measure": "games_count",
                          "actions": {
                            "click": { "type": "drilldown", "target": "players", "columnsPreset": "opponentMode", "filterFromPoint": false }
                          }
                        },
                        {
                          "label": "Wins",
                          "measure": "win_count",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "result", "op": "eq", "value": "Win" }]
                            }
                          }
                        },
                        {
                          "label": "Win rate",
                          "measure": "win_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "result", "op": "eq", "value": "Win" }]
                            }
                          }
                        },
                        { "label": "Avg end rating", "measure": "end_rating_avg" },
                        { "label": "Avg rating delta", "measure": "rating_delta_avg" }
                      ]
                    }
                  },

                  {
                    "widgetId": "w_overview_mode_breakdown",
                    "type": "breakdown",
                    "title": "Mode Breakdown",
                    "grain": "game",
                    "placement": { "x": 0, "y": 7, "w": 12, "h": 4 },
                    "spec": {
                      "dimension": "mode_family",
                      "measure": "games_count",
                      "sort": { "mode": "desc" },
                      "limit": 12,
                      "actions": {
                        "click": {
                          "type": "drilldown",
                          "target": "players",
                          "columnsPreset": "opponentMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  },

                  {
                    "widgetId": "w_overview_movement_breakdown",
                    "type": "breakdown",
                    "title": "Movement Breakdown",
                    "grain": "round",
                    "placement": { "x": 0, "y": 11, "w": 12, "h": 4 },
                    "spec": {
                      "dimension": "movement_type",
                      "measure": "rounds_count",
                      "sort": { "mode": "desc" },
                      "limit": 12,
                      "actions": {
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  },

                  {
                    "widgetId": "w_overview_time_progression",
                    "type": "chart",
                    "title": "Time progression metrics",
                    "grain": "round",
                    "placement": { "x": 0, "y": 15, "w": 12, "h": 7 },
                    "spec": {
                      "type": "line",
                      "x": { "dimension": "time_day" },
                      "y": {
                        "measures": [
                          "games_count",
                          "rounds_count",
                          "avg_score",
                          "avg_score_hit_only",
                          "avg_distance_km",
                          "avg_guess_duration",
                          "throw_rate",
                          "throw_count",
                          "fivek_rate",
                          "fivek_count",
                          "hit_rate",
                          "hit_count",
                          "win_rate",
                          "win_count",
                          "end_rating_avg",
                          "damage_dealt_avg",
                          "damage_taken_avg"
                        ],
                        "activeMeasure": "games_count",
                        "accumulations": ["period", "to_date"],
                        "activeAccumulation": "to_date"
                      },
                      "sort": { "mode": "chronological" },
                      "actions": { "hover": true }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      {
        "id": "scores",
        "title": "Scores",
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_scores_kpis",
              "title": "Score KPIs",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 6,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_scores_kpis",
                    "type": "stat_list",
                    "title": "KPIs (round-grain)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 6 },
                    "spec": {
                      "rows": [
                        { "label": "Rounds", "measure": "rounds_count" },
                        { "label": "Avg score", "measure": "avg_score" },
                        {
                          "label": "5k rate",
                          "measure": "fivek_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": false,
                              "extraFilters": [
                                { "dimension": "score_bucket", "op": "eq", "value": "5000" }
                              ]
                            }
                          }
                        },
                        { "label": "Hit rate", "measure": "hit_rate" },
                        { "label": "Throw rate (<50)", "measure": "throw_rate" }
                      ]
                    }
                  }
                ]
              }
            },

            {
              "cardId": "card_score_distribution",
              "title": "Score Distribution",
              "x": 0,
              "y": 6,
              "w": 12,
              "h": 12,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_score_distribution",
                    "type": "chart",
                    "title": "Score bucket distribution (click = drilldown rounds)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 12 },
                    "spec": {
                      "type": "bar",
                      "x": { "dimension": "score_bucket" },
                      "y": { "measure": "rounds_count" },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },

      {
        "id": "time_patterns",
        "title": "Time Patterns",
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_by_weekday",
              "title": "By weekday",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_avg_score_weekday",
                    "type": "chart",
                    "title": "Avg score by weekday",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "bar",
                      "x": { "dimension": "weekday" },
                      "y": { "measure": "avg_score" },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            },

            {
              "cardId": "card_by_hour",
              "title": "By hour",
              "x": 0,
              "y": 10,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_fivek_rate_hour",
                    "type": "chart",
                    "title": "Rate by hour",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "bar",
                      "color": "#ff8a3d",
                      "x": { "dimension": "hour" },
                      "y": {
                        "measures": ["fivek_rate", "throw_rate", "hit_rate"],
                        "activeMeasure": "fivek_rate"
                      },
                      "sorts": [{ "mode": "desc" }, { "mode": "asc" }, { "mode": "chronological" }],
                      "activeSort": { "mode": "desc" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            },

            {
              "cardId": "card_by_day",
              "title": "Daily progression",
              "x": 0,
              "y": 20,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_avg_score_day",
                    "type": "chart",
                    "title": "Avg score by day (bar)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "bar",
                      "x": { "dimension": "time_day" },
                      "y": { "measure": "avg_score" },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            },
            {
              "cardId": "card_line_progress",
              "title": "Progress over time (line)",
              "x": 0,
              "y": 30,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_line_avg_score_day",
                    "type": "chart",
                    "title": "Avg score by day (line)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "line",
                      "x": { "dimension": "time_day" },
                      "y": { "measure": "avg_score" },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            }
            ,
            {
              "cardId": "card_rating_over_time",
              "title": "Rating over time",
              "x": 0,
              "y": 40,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_rating_over_time",
                    "type": "chart",
                    "title": "Avg end rating by day",
                    "grain": "game",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "line",
                      "x": { "dimension": "time_day" },
                      "y": { "measure": "end_rating_avg" },
                      "sort": { "mode": "chronological" },
                      "actions": { "hover": true }
                    }
                  }
                ]
              }
            }
          ]
        }
      },

      {
        "id": "countries",
        "title": "Countries",
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_countries_breakdown",
              "title": "True country breakdown",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_country_rounds_top",
                    "type": "breakdown",
                    "title": "Top countries by rounds (click = drilldown rounds)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                      "spec": {
                        "dimension": "true_country",
                        "measures": ["rounds_count", "avg_score", "rate_5k", "throw_rate", "hit_rate"],
                        "activeMeasure": "rounds_count",
                        "sort": { "mode": "desc" },
                        "limit": 15,
                        "extendable": true,
                        "actions": {
                          "click": {
                            "type": "drilldown",
                            "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            },

            {
              "cardId": "card_country_quality",
              "title": "Quality by country",
              "x": 0,
              "y": 10,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_country_avg_score",
                    "type": "chart",
                    "title": "Avg score by country (top-ish)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "bar",
                      "limit": 12,
                      "x": { "dimension": "true_country" },
                      "y": { "measure": "avg_score" },
                      "sort": { "mode": "desc" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    ]
  }
}
