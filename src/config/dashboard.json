{
  "$schema": "./dashboard.schema.json",
  "schemaVersion": "0.1.0",
  "dashboard": {
    "id": "default",
    "title": "GeoAnalyzr",
    "globalFilters": {
      "enabled": true,
      "layout": { "variant": "compact" },
      "controls": [
        {
          "id": "dateRange",
          "type": "date_range",
          "label": "From / To",
          "default": { "fromTs": null, "toTs": null },
          "appliesTo": ["round", "game", "session"]
        },
        {
          "id": "modeFamily",
          "type": "select",
          "label": "Game mode",
          "dimension": "mode_family",
          "default": "all",
          "options": "auto_distinct",
          "appliesTo": ["round", "game"]
        },
        {
          "id": "teammate",
          "type": "select",
          "label": "Teammate",
          "dimension": "teammate_name",
          "default": "all",
          "options": "auto_teammates",
          "appliesTo": ["round", "game"]
        },
        {
          "id": "movement",
          "type": "select",
          "label": "Movement",
          "dimension": "movement_type",
          "default": "all",
          "options": "auto_distinct",
          "appliesTo": ["round"]
        },
        {
          "id": "guessTimeBucket",
          "type": "select",
          "label": "Guess time",
          "dimension": "duration_bucket",
          "default": "all",
          "options": "auto_distinct",
          "appliesTo": ["round"]
        },
        {
          "id": "country",
          "type": "select",
          "label": "Country",
          "dimension": "true_country",
          "default": "all",
          "options": "auto_distinct",
          "appliesTo": ["round"]
        }
      ],
      "buttons": { "apply": false, "reset": true }
    },
    "sections": [
      {
        "id": "overview",
        "title": "Overview",
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_overview_main",
              "title": "Overview",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 22,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_overview_facts",
                    "type": "stat_list",
                    "title": "Results, Win Rate & Streaks",
                    "grain": "game",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 7 },
                    "spec": {
                      "rows": [
                        {
                          "label": "Games with result data",
                          "measure": "games_with_result_count",
                          "actions": { "click": { "type": "drilldown", "target": "players", "columnsPreset": "opponentMode", "filterFromPoint": false } }
                        },
                        {
                          "label": "Wins",
                          "measure": "win_count",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "result", "op": "eq", "value": "Win" }]
                            }
                          }
                        },
                        {
                          "label": "Losses",
                          "measure": "loss_count",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "result", "op": "eq", "value": "Loss" }]
                            }
                          }
                        },
                        {
                          "label": "Win rate",
                          "measure": "win_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "result", "op": "eq", "value": "Win" }]
                            }
                          }
                        },
                        {
                          "label": "Best rating",
                          "measure": "best_end_rating",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false,
                              "initialSort": { "key": "endRating", "dir": "desc" }
                            }
                          }
                        },
                        {
                          "label": "Longest win streak",
                          "measure": "longest_win_streak",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false
                            }
                          }
                        },
                        {
                          "label": "Longest loss streak",
                          "measure": "longest_loss_streak",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "players",
                              "columnsPreset": "opponentMode",
                              "filterFromPoint": false
                            }
                          }
                        },
                        {
                          "label": "Avg score (pts)",
                          "measure": "avg_score",
                          "grain": "round",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": false } }
                        },
                        {
                          "label": "Avg distance (km)",
                          "measure": "avg_distance_km",
                          "grain": "round",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": false } }
                        },
                        {
                          "label": "Avg time (s)",
                          "measure": "avg_guess_duration",
                          "grain": "round",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": false } }
                        },
                        {
                          "label": "Time played",
                          "measure": "time_played_seconds",
                          "grain": "round",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": false } }
                        },
                        {
                          "label": "Perfect 5k rounds",
                          "measure": "fivek_count",
                          "grain": "round",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": false } }
                        },
                        {
                          "label": "Throws (<50)",
                          "measure": "throw_count",
                          "grain": "round",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": false } }
                        }
                      ]
                    }
                  },

                  {
                    "widgetId": "w_overview_mode_breakdown",
                    "type": "breakdown",
                    "title": "Mode Breakdown",
                    "grain": "game",
                    "placement": { "x": 0, "y": 7, "w": 12, "h": 4 },
                    "spec": {
                      "dimension": "mode_family",
                      "excludeKeys": ["other", "Streak"],
                      "measure": "games_count",
                      "sort": { "mode": "desc" },
                      "limit": 12,
                      "actions": {
                        "click": {
                          "type": "drilldown",
                          "target": "players",
                          "columnsPreset": "opponentMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  },

                  {
                    "widgetId": "w_overview_movement_breakdown",
                    "type": "breakdown",
                    "title": "Movement Breakdown",
                    "grain": "round",
                    "placement": { "x": 0, "y": 11, "w": 12, "h": 4 },
                    "spec": {
                      "dimension": "movement_type",
                      "measure": "rounds_count",
                      "sort": { "mode": "desc" },
                      "limit": 12,
                      "actions": {
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  },

                  {
                    "widgetId": "w_overview_time_progression",
                    "type": "chart",
                    "title": "Time progression metrics",
                    "grain": "round",
                    "placement": { "x": 0, "y": 15, "w": 12, "h": 7 },
                    "spec": {
                      "type": "line",
                      "maxPoints": 100,
                      "x": { "dimension": "time_day" },
                      "y": {
                        "measures": [
                          "games_count",
                          "rounds_count",
                          "time_played_seconds",
                          "avg_score",
                          "avg_score_hit_only",
                          "avg_distance_km",
                          "avg_guess_duration",
                          "throw_rate",
                          "throw_count",
                          "fivek_rate",
                          "fivek_count",
                          "hit_rate",
                          "hit_count",
                          "win_rate",
                          "win_count",
                          "end_rating",
                          "damage_dealt_avg",
                          "damage_taken_avg"
                        ],
                        "activeMeasure": "games_count",
                        "accumulations": ["period", "to_date"],
                        "activeAccumulation": "to_date"
                      },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      {
        "id": "rating",
        "title": "Rating",
        "filterScope": { "exclude": ["movement", "guessTimeBucket", "country"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_rating",
              "title": "Rating",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 16,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_rating_kpis",
                    "type": "stat_list",
                    "title": "Rating",
                    "grain": "game",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 4 },
                    "spec": {
                      "rows": [
                        { "label": "Current rating", "measure": "end_rating" },
                        { "label": "Trend", "measure": "rating_trend" },
                        { "label": "Avg rating delta", "measure": "rating_delta_avg" }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_rating_session_records",
                    "type": "record_list",
                    "title": "Sessions",
                    "grain": "session",
                    "placement": { "x": 0, "y": 4, "w": 12, "h": 4 },
                    "spec": {
                      "records": [
                        {
                          "id": "biggest_session_rating_gain",
                          "label": "Biggest session rating gain",
                          "metric": "session_delta_rating",
                          "groupBy": "session_start",
                          "extreme": "max",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "biggest_session_rating_loss",
                          "label": "Biggest session rating loss",
                          "metric": "session_delta_rating",
                          "groupBy": "session_start",
                          "extreme": "min",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_rating_over_time",
                    "type": "chart",
                    "title": "Rating over time",
                    "grain": "game",
                    "placement": { "x": 0, "y": 8, "w": 12, "h": 8 },
                    "spec": {
                      "type": "line",
                      "maxPoints": 220,
                      "x": { "dimension": "time_day" },
                      "y": { "measures": ["end_rating"], "activeMeasure": "end_rating" },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "players",
                          "columnsPreset": "opponentMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      {
        "id": "personal_records",
        "title": "Personal Records",
        "filterScope": { "exclude": ["movement", "guessTimeBucket"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_personal_records",
              "title": "Personal Records",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_personal_records",
                    "type": "record_list",
                    "title": "Personal Records",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "records": [
                        {
                          "id": "best_day",
                          "label": "Best day",
                          "metric": "avg_score",
                          "groupBy": "time_day",
                          "extreme": "max",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "hardest_day",
                          "label": "Hardest day",
                          "metric": "avg_score",
                          "groupBy": "time_day",
                          "extreme": "min",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "best_game_avg_score",
                          "label": "Best avg score in a game",
                          "metric": "avg_score",
                          "groupBy": "game_id",
                          "extreme": "max",
                          "displayKey": "first_ts",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "worst_game_avg_score",
                          "label": "Worst avg score in a game",
                          "metric": "avg_score",
                          "groupBy": "game_id",
                          "extreme": "min",
                          "displayKey": "first_ts",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "fastest_day",
                          "label": "Fastest day",
                          "metric": "avg_guess_duration",
                          "groupBy": "time_day",
                          "extreme": "min",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "slowest_day",
                          "label": "Slowest day",
                          "metric": "avg_guess_duration",
                          "groupBy": "time_day",
                          "extreme": "max",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "best_5k_streak",
                          "label": "Best 5k streak",
                          "kind": "streak",
                          "streakFilters": [{ "dimension": "score_bucket", "op": "eq", "value": "5000" }],
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "score_bucket", "op": "eq", "value": "5000" }]
                            }
                          }
                        },
                        {
                          "id": "worst_throw_streak",
                          "label": "Worst throw streak (<50)",
                          "kind": "streak",
                          "streakFilters": [{ "dimension": "is_throw", "op": "eq", "value": "true" }],
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "is_throw", "op": "eq", "value": "true" }]
                            }
                          }
                        }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      {
        "id": "sessions",
        "title": "Sessions",
        "filterScope": { "exclude": ["movement", "guessTimeBucket"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_sessions",
              "title": "Sessions",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 20,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_sessions_kpis",
                    "type": "stat_list",
                    "title": "Sessions",
                    "grain": "session",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 4 },
                    "spec": {
                      "rows": [
                        { "label": "Sessions detected (gap >45m)", "measure": "sessions_count" },
                        { "label": "Longest break between sessions", "measure": "sessions_longest_break_seconds" },
                        { "label": "Avg games per session", "measure": "sessions_avg_games" }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_sessions_records",
                    "type": "record_list",
                    "title": "Session Records",
                    "grain": "session",
                    "placement": { "x": 0, "y": 4, "w": 12, "h": 5 },
                    "spec": {
                      "records": [
                        {
                          "id": "longest_session",
                          "label": "Longest session",
                          "metric": "session_games_count",
                          "groupBy": "session_start",
                          "extreme": "max",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "best_session",
                          "label": "Best session",
                          "metric": "session_avg_score",
                          "groupBy": "session_start",
                          "extreme": "max",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "worst_session",
                          "label": "Worst session",
                          "metric": "session_avg_score",
                          "groupBy": "session_start",
                          "extreme": "min",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_sessions_line",
                    "type": "chart",
                    "title": "Sessions over time (line)",
                    "grain": "session",
                    "placement": { "x": 0, "y": 9, "w": 12, "h": 5 },
                    "spec": {
                      "type": "line",
                      "maxPoints": 120,
                      "x": { "dimension": "session_index" },
                      "y": {
                        "measures": [
                          "session_avg_score",
                          "session_fivek_rate",
                          "session_throw_rate",
                          "session_hit_rate",
                          "session_games_count",
                          "session_rounds_count",
                          "session_avg_guess_duration",
                          "session_avg_distance_km"
                        ],
                        "activeMeasure": "session_avg_score"
                      },
                      "sort": { "mode": "chronological" },
                      "actions": { "hover": true, "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                    }
                  },
                  {
                    "widgetId": "w_sessions_breakdown",
                    "type": "breakdown",
                    "title": "Sessions (bar)",
                    "grain": "session",
                    "placement": { "x": 0, "y": 14, "w": 12, "h": 6 },
                    "spec": {
                      "dimension": "session_start",
                      "measures": [
                        "session_avg_score",
                        "session_fivek_rate",
                        "session_throw_rate",
                        "session_hit_rate",
                        "session_games_count",
                        "session_rounds_count"
                      ],
                      "activeMeasure": "session_avg_score",
                      "sorts": [{ "mode": "chronological" }, { "mode": "desc" }, { "mode": "asc" }],
                      "activeSort": { "mode": "chronological" },
                      "limit": 12,
                      "extendable": true,
                      "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      {
        "id": "tempo",
        "title": "Tempo",
        "filterScope": { "exclude": ["movement", "guessTimeBucket"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_tempo",
              "title": "Tempo",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 14,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_tempo_records",
                    "type": "record_list",
                    "title": "Tempo",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 6 },
                    "spec": {
                      "records": [
                        {
                          "id": "fastest_guess",
                          "label": "Fastest guess",
                          "metric": "avg_guess_duration",
                          "groupBy": "round_id",
                          "extreme": "min",
                          "displayKey": "first_ts_score",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "slowest_guess",
                          "label": "Slowest guess",
                          "metric": "avg_guess_duration",
                          "groupBy": "round_id",
                          "extreme": "max",
                          "displayKey": "first_ts_score",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "fastest_5k",
                          "label": "Fastest 5k",
                          "metric": "avg_guess_duration",
                          "groupBy": "round_id",
                          "extreme": "min",
                          "filters": [{ "dimension": "score_bucket", "op": "eq", "value": "5000" }],
                          "displayKey": "first_ts",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "score_bucket", "op": "eq", "value": "5000" }]
                            }
                          }
                        },
                        {
                          "id": "slowest_throw",
                          "label": "Slowest throw (<50)",
                          "metric": "avg_guess_duration",
                          "groupBy": "round_id",
                          "extreme": "max",
                          "filters": [{ "dimension": "is_throw", "op": "eq", "value": "true" }],
                          "displayKey": "first_ts_score",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "is_throw", "op": "eq", "value": "true" }]
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_tempo_bucket_breakdown",
                    "type": "breakdown",
                    "title": "Tempo - Time bucket metrics",
                    "grain": "round",
                    "placement": { "x": 0, "y": 6, "w": 12, "h": 8 },
                    "spec": {
                      "dimension": "duration_bucket",
                      "measures": ["avg_score", "fivek_rate", "throw_rate", "hit_rate", "avg_guess_duration"],
                      "activeMeasure": "avg_score",
                      "sorts": [{ "mode": "chronological" }, { "mode": "desc" }, { "mode": "asc" }],
                      "activeSort": { "mode": "chronological" },
                      "limit": 12,
                      "actions": {
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      {
        "id": "scores",
        "title": "Scores",
        "filterScope": { "exclude": ["movement", "guessTimeBucket"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_scores_kpis",
              "title": "Scores",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 14,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_scores_kpis",
                    "type": "stat_list",
                    "title": "Scores",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 4 },
                    "spec": {
                      "rows": [
                        {
                          "label": "Perfect 5k",
                          "measure": "fivek_count",
                          "secondaryMeasure": "fivek_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "score_bucket", "op": "eq", "value": "5000" }]
                            }
                          }
                        },
                        {
                          "label": "Near-perfect (>=4500)",
                          "measure": "near_perfect_count",
                          "secondaryMeasure": "near_perfect_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "is_near_perfect", "op": "eq", "value": "true" }]
                            }
                          }
                        },
                        {
                          "label": "Low scores (<500)",
                          "measure": "low_score_count",
                          "secondaryMeasure": "low_score_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "is_low_score", "op": "eq", "value": "true" }]
                            }
                          }
                        },
                        {
                          "label": "Throws (<50)",
                          "measure": "throw_count",
                          "secondaryMeasure": "throw_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": false,
                              "extraFilters": [{ "dimension": "is_throw", "op": "eq", "value": "true" }]
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_score_distribution",
                    "type": "chart",
                    "title": "Scores - Score distribution (smoothed)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 4, "w": 12, "h": 10 },
                    "spec": {
                      "type": "bar",
                      "limit": 200,
                      "x": { "dimension": "score_bucket" },
                      "y": { "measure": "rounds_count" },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },

      {
        "id": "rounds",
        "title": "Rounds",
        "filterScope": { "exclude": ["movement", "guessTimeBucket", "country"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_rounds",
              "title": "Rounds",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 24,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_rounds_records",
                    "type": "record_list",
                    "title": "Rounds",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 7 },
                    "spec": {
                      "records": [
                        {
                          "id": "game_most_rounds",
                          "label": "Game with most rounds",
                          "metric": "rounds_count",
                          "groupBy": "game_id",
                          "extreme": "max",
                          "displayKey": "first_ts",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "game_fewest_rounds",
                          "label": "Games with fewest rounds",
                          "metric": "rounds_count",
                          "groupBy": "game_id",
                          "extreme": "min",
                          "displayKey": "first_ts",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "largest_score_spread_game",
                          "label": "Largest score spread (max-min in one game)",
                          "metric": "score_spread",
                          "groupBy": "game_id",
                          "extreme": "max",
                          "displayKey": "first_ts",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "fast_round_streak",
                          "label": "Fastest round streak (<20s)",
                          "kind": "streak",
                          "streakFilters": [{ "dimension": "duration_bucket", "op": "eq", "value": "<20 sec" }],
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "duration_bucket", "op": "eq", "value": "<20 sec" }]
                            }
                          }
                        },
                        {
                          "id": "damage_dealt_streak",
                          "label": "Damage dealt streak",
                          "kind": "streak",
                          "streakFilters": [{ "dimension": "is_damage_dealt", "op": "eq", "value": "true" }],
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "is_damage_dealt", "op": "eq", "value": "true" }]
                            }
                          }
                        },
                        {
                          "id": "damage_taken_streak",
                          "label": "Damage taken streak",
                          "kind": "streak",
                          "streakFilters": [{ "dimension": "is_damage_taken", "op": "eq", "value": "true" }],
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "is_damage_taken", "op": "eq", "value": "true" }]
                            }
                          }
                        },
                        {
                          "id": "same_country_streak",
                          "label": "Longest same-country streak",
                          "kind": "same_value_streak",
                          "dimension": "true_country",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        },
                        {
                          "id": "correct_country_streak",
                          "label": "Correct-country streak",
                          "kind": "streak",
                          "streakFilters": [{ "dimension": "is_hit", "op": "eq", "value": "true" }],
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "filterFromPoint": true,
                              "extraFilters": [{ "dimension": "is_hit", "op": "eq", "value": "true" }]
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_rounds_progression",
                    "type": "chart",
                    "title": "Rounds - Round progression metrics",
                    "grain": "round",
                    "placement": { "x": 0, "y": 7, "w": 12, "h": 8 },
                    "spec": {
                      "type": "bar",
                      "x": { "dimension": "round_number" },
                      "y": {
                        "measures": [
                          "avg_score",
                          "avg_score_hit_only",
                          "avg_distance_km",
                          "avg_guess_duration",
                          "fivek_rate",
                          "throw_rate",
                          "hit_rate",
                          "damage_dealt_avg",
                          "damage_taken_avg"
                        ],
                        "activeMeasure": "avg_score"
                      },
                      "sorts": [{ "mode": "chronological" }, { "mode": "desc" }, { "mode": "asc" }],
                      "activeSort": { "mode": "chronological" },
                      "limit": 20,
                      "actions": {
                        "hover": true,
                        "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true }
                      }
                    }
                  },
                  {
                    "widgetId": "w_game_length_perf",
                    "type": "chart",
                    "title": "Rounds - Performance by game length (rounds per game, 2+)",
                    "grain": "game",
                    "placement": { "x": 0, "y": 15, "w": 12, "h": 9 },
                    "spec": {
                      "type": "bar",
                      "x": { "dimension": "game_length" },
                      "y": {
                        "measures": ["games_count", "win_rate", "win_count", "loss_count", "tie_count", "best_end_rating"],
                        "activeMeasure": "games_count"
                      },
                      "sorts": [{ "mode": "chronological" }, { "mode": "desc" }, { "mode": "asc" }],
                      "activeSort": { "mode": "chronological" },
                      "limit": 20,
                      "actions": {
                        "hover": true,
                        "click": { "type": "drilldown", "target": "players", "columnsPreset": "opponentMode", "filterFromPoint": true }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },

      {
        "id": "time_patterns",
        "title": "Time Patterns",
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_by_weekday",
              "title": "By weekday",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "by_weekday_chart",
                    "type": "chart",
                    "title": "Weekday Analysis",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "bar",
                      "x": { "dimension": "weekday" },
                      "y": {
                        "measures": [
                          "games_count",
                          "rounds_count",
                          "avg_score",
                          "avg_score_hit_only",
                          "avg_distance_km",
                          "avg_guess_duration",
                          "throw_rate",
                          "throw_count",
                          "fivek_rate",
                          "fivek_count",
                          "hit_rate",
                          "hit_count",
                          "win_rate",
                          "win_count",
                          "damage_dealt_avg",
                          "damage_taken_avg"
                        ],
                        "activeMeasure": "games_count"
                      },
                      "sorts": [{ "mode": "desc" }, { "mode": "asc" }, { "mode": "chronological" }],
                      "activeSort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            },

            {
              "cardId": "card_by_hour",
              "title": "By hour",
              "x": 0,
              "y": 10,
              "w": 12,
              "h": 10,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "by_hour_chart",
                    "type": "chart",
                    "title": "Hour Analysis",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                    "spec": {
                      "type": "bar",
                      "color": "#ff8a3d",
                      "x": { "dimension": "hour" },
                      "y": {
                        "measures": [
                          "games_count",
                          "rounds_count",
                          "avg_score",
                          "avg_score_hit_only",
                          "avg_distance_km",
                          "avg_guess_duration",
                          "throw_rate",
                          "throw_count",
                          "fivek_rate",
                          "fivek_count",
                          "hit_rate",
                          "hit_count",
                          "win_rate",
                          "win_count",
                          "damage_dealt_avg",
                          "damage_taken_avg"
                        ],
                        "activeMeasure": "games_count"
                      },
                      "sorts": [{ "mode": "desc" }, { "mode": "asc" }, { "mode": "chronological" }],
                      "activeSort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": {
                          "type": "drilldown",
                          "target": "rounds",
                          "columnsPreset": "roundMode",
                          "filterFromPoint": true
                        }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      },

      {
        "id": "countries",
        "title": "Countries",
        "filterScope": { "exclude": ["movement", "guessTimeBucket", "country"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_countries",
              "title": "Countries",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 18,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_country_metrics",
                    "type": "breakdown",
                    "title": "Countries - Country metrics",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 10 },
                      "spec": {
                        "dimension": "true_country",
                        "measures": [
                          "avg_score",
                          "avg_score_hit_only",
                          "avg_distance_km",
                          "avg_guess_duration",
                          "rounds_count",
                          "fivek_rate",
                          "fivek_count",
                          "throw_rate",
                          "throw_count",
                          "hit_rate",
                          "hit_count",
                          "damage_dealt_avg",
                          "damage_taken_avg",
                          "damage_dealt_share",
                          "damage_taken_share"
                        ],
                        "activeMeasure": "avg_score",
                        "sorts": [{ "mode": "desc" }, { "mode": "asc" }],
                        "activeSort": { "mode": "desc" },
                        "limit": 15,
                        "extendable": true,
                        "actions": {
                          "click": {
                            "type": "drilldown",
                            "target": "rounds",
                            "columnsPreset": "roundMode",
                            "filterFromPoint": true
                          }
                        }
                      
                    }
                  }
                  ,
                  {
                    "widgetId": "w_country_confusion",
                    "type": "chart",
                    "title": "Countries - Confusion matrix (top pairs)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 10, "w": 12, "h": 8 },
                    "spec": {
                      "type": "bar",
                      "limit": 20,
                      "x": { "dimension": "confused_countries" },
                      "y": { "measure": "rounds_count" },
                      "sort": { "mode": "desc" },
                      "actions": {
                        "hover": true,
                        "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      }
      ,
      {
        "id": "opponents",
        "title": "Opponents",
        "filterScope": { "exclude": ["movement", "guessTimeBucket", "country"] },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_opponents",
              "title": "Opponents",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 18,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_opponents_scope",
                    "type": "stat_list",
                    "title": "Scope",
                    "grain": "game",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 3 },
                    "spec": {
                      "rows": [
                        { "label": "Unique opponents", "measure": "unique_opponents_count" },
                        { "label": "Unique countries", "measure": "unique_opponent_countries_count" },
                        {
                          "label": "Strongest opponent (rating)",
                          "measure": "strongest_opponent_rating",
                          "actions": { "click": { "type": "drilldown", "target": "players", "columnsPreset": "opponentMode", "filterFromPoint": false } }
                        },
                        {
                          "label": "Strongest defeated opponent (rating)",
                          "measure": "strongest_defeated_opponent_rating",
                          "actions": { "click": { "type": "drilldown", "target": "players", "columnsPreset": "opponentMode", "filterFromPoint": false } }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_opponents_by_country",
                    "type": "chart",
                    "title": "Opponents - Match-ups by opponent country",
                    "grain": "game",
                    "placement": { "x": 0, "y": 3, "w": 12, "h": 8 },
                    "spec": {
                      "type": "bar",
                      "limit": 20,
                      "x": { "dimension": "opponent_country" },
                      "y": { "measure": "matchups_count" },
                      "sort": { "mode": "desc" },
                      "actions": {
                        "hover": true,
                        "click": { "type": "drilldown", "target": "players", "columnsPreset": "opponentMode", "filterFromPoint": true }
                      }
                    }
                  },
                  {
                    "widgetId": "w_opponents_top",
                    "type": "breakdown",
                    "title": "Opponents - Top opponents",
                    "grain": "game",
                    "placement": { "x": 0, "y": 11, "w": 12, "h": 7 },
                    "spec": {
                      "dimension": "opponent_name",
                      "measure": "matchups_count",
                      "sort": { "mode": "desc" },
                      "limit": 15,
                      "extendable": true,
                      "actions": {
                        "click": { "type": "drilldown", "target": "players", "columnsPreset": "opponentMode", "filterFromPoint": true }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      }
      ,
      {
        "id": "team",
        "title": "Team",
        "localFilters": {
          "enabled": true,
          "controls": [
            {
              "id": "mate",
              "type": "select",
              "label": "Mate",
              "dimension": "teammate_name",
              "default": "auto_top",
              "options": "auto_teammates",
              "required": true,
              "appliesTo": ["round"]
            }
          ],
          "buttons": { "reset": true }
        },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_team",
              "title": "Team: You + {{local.mate}}",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 18,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_team_h2h",
                    "type": "leader_list",
                    "title": "Head-to-head questions",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 5 },
                    "spec": {
                      "rows": [
                        {
                          "label": "Closer guesses",
                          "dimension": "team_closer_winner",
                          "excludeKeys": ["Tie"],
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } }
                        },
                        {
                          "label": "Higher score rounds",
                          "dimension": "team_higher_score_winner",
                          "excludeKeys": ["Tie"],
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } }
                        },
                        {
                          "label": "Fewer throws (<50)",
                          "dimension": "team_fewer_throw_winner",
                          "excludeKeys": ["Tie"],
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } }
                        },
                        {
                          "label": "More 5k rounds",
                          "dimension": "team_more_5k_winner",
                          "excludeKeys": ["Tie"],
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_team_facts_round",
                    "type": "stat_list",
                    "title": "Team facts",
                    "grain": "round",
                    "placement": { "x": 0, "y": 5, "w": 12, "h": 5 },
                    "spec": {
                      "rows": [
                        { "label": "Games together", "measure": "games_distinct_count", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        { "label": "Rounds together", "measure": "rounds_count", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        { "label": "Time played together", "measure": "time_played_seconds", "secondaryMeasure": "rounds_with_time_count", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        { "label": "First game together", "measure": "first_played_at", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        { "label": "Most recent game together", "measure": "last_played_at", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_team_session_records",
                    "type": "record_list",
                    "title": "Session records together",
                    "grain": "session",
                    "placement": { "x": 0, "y": 10, "w": 12, "h": 4 },
                    "spec": {
                      "records": [
                        {
                          "id": "longest_session_together",
                          "label": "Longest session together",
                          "metric": "session_games_count",
                          "groupBy": "session_start",
                          "extreme": "max",
                          "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true } }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_team_facts_sessions",
                    "type": "stat_list",
                    "title": "Session stats together",
                    "grain": "session",
                    "placement": { "x": 0, "y": 14, "w": 12, "h": 4 },
                    "spec": {
                      "rows": [
                        { "label": "Sessions detected (gap > session standard)", "measure": "sessions_count" },
                        { "label": "Longest break between sessions", "measure": "sessions_longest_break_seconds" },
                        { "label": "Avg games per session", "measure": "sessions_avg_games" }
                      ]
                    }
                  }
                ]
              }
            }
          ]
        }
      }
      ,
      {
        "id": "country_insight",
        "title": "Country Insight",
        "filterScope": { "exclude": ["country"] },
        "localFilters": {
          "enabled": true,
          "controls": [
            {
              "id": "spotlightCountry",
              "type": "select",
              "label": "Country",
              "dimension": "true_country",
              "presentation": "map",
              "map": {
                "variant": "wide",
                "height": 720,
                "restrictToOptions": true,
                "tintSelectable": true
              },
              "default": "auto_top",
              "options": "auto_distinct",
              "required": true,
              "appliesTo": ["round"]
            }
          ],
          "buttons": { "reset": false }
        },
        "layout": {
          "mode": "grid",
          "columns": 12,
          "cards": [
            {
              "cardId": "card_country_insight",
              "title": "Country Spotlight: {{local.spotlightCountry}}",
              "x": 0,
              "y": 0,
              "w": 12,
              "h": 18,
              "card": {
                "type": "composite",
                "children": [
                  {
                    "widgetId": "w_country_insight_stats",
                    "type": "stat_list",
                    "title": "Country spotlight",
                    "grain": "round",
                    "placement": { "x": 0, "y": 0, "w": 12, "h": 6 },
                    "spec": {
                      "rows": [
                        { "label": "Rounds", "measure": "rounds_count", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        { "label": "Hit rate", "measure": "hit_rate", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        { "label": "Avg score", "measure": "avg_score", "secondaryMeasure": "score_median", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        { "label": "Avg distance", "measure": "avg_distance_km", "actions": { "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode" } } },
                        {
                          "label": "Perfect 5k in this country",
                          "measure": "fivek_count",
                          "secondaryMeasure": "fivek_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "extraFilters": [{ "dimension": "score_bucket", "op": "eq", "value": "5000" }]
                            }
                          }
                        },
                        {
                          "label": "Throws (<50) in this country",
                          "measure": "throw_count",
                          "secondaryMeasure": "throw_rate",
                          "actions": {
                            "click": {
                              "type": "drilldown",
                              "target": "rounds",
                              "columnsPreset": "roundMode",
                              "extraFilters": [{ "dimension": "is_throw", "op": "eq", "value": "true" }]
                            }
                          }
                        }
                      ]
                    }
                  },
                  {
                    "widgetId": "w_country_insight_confusions",
                    "type": "breakdown",
                    "title": "Top confusions (guessed country on misses)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 6, "w": 12, "h": 4 },
                    "spec": {
                      "dimension": "guess_country",
                      "measure": "rounds_count",
                      "filters": [{ "dimension": "is_hit", "op": "eq", "value": "false" }],
                      "sort": { "mode": "desc" },
                      "limit": 3,
                      "actions": {
                        "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true }
                      }
                    }
                  },
                  {
                    "widgetId": "w_country_insight_distribution",
                    "type": "chart",
                    "title": "Score distribution (smoothed)",
                    "grain": "round",
                    "placement": { "x": 0, "y": 10, "w": 12, "h": 8 },
                    "spec": {
                      "type": "bar",
                      "limit": 200,
                      "x": { "dimension": "score_bucket" },
                      "y": { "measure": "rounds_count" },
                      "sort": { "mode": "chronological" },
                      "actions": {
                        "hover": true,
                        "click": { "type": "drilldown", "target": "rounds", "columnsPreset": "roundMode", "filterFromPoint": true }
                      }
                    }
                  }
                ]
              }
            }
          ]
        }
      }
    ]
  }
}
